{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useCallback, useEffect, useState } from \"react\";\nexport function useChat(characterId) {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [favor, setFavor] = useState(0);\n  const userId = \"user_74127\";\n\n  // 메시지 불러오기\n  useEffect(() => {\n    if (!characterId) return;\n    fetch(`/api/chat?userId=${userId}&characterId=${characterId}`).then(res => res.json()).then(data => {\n      if (data.ok) {\n        setMessages(data.messages.map(msg => ({\n          sender: msg.sender,\n          text: msg.message,\n          avatar: msg.sender === \"ai\" ? `/avatars/${characterId}.jpg` : undefined\n        })));\n      }\n    });\n  }, [characterId]);\n  const sendMessage = useCallback(async msg => {\n    if (!msg.trim()) return;\n    setLoading(true);\n    // 사용자가 보낸 메시지\n    setMessages(prev => [...prev, {\n      sender: \"user\",\n      text: msg\n    }]);\n    const userMsg = msg;\n    setInput(\"\");\n    try {\n      // 최근 10개 대사 history로 전송, 5턴마다만 체크\n      const shouldCheckFavor = (messages.length + 1) % 5 === 0;\n      const response = await fetch(\"/api/chat\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          userId,\n          characterId,\n          message: userMsg,\n          sender: \"user\",\n          history: shouldCheckFavor ? messages.slice(-9).concat([{\n            sender: \"user\",\n            text: msg\n          }]) : undefined\n        })\n      });\n      const data = await response.json();\n      if (data.ok) {\n        // AI 답변이 있으면 메시지에 추가\n        if (data.aiText) {\n          setMessages(prev => [...prev, {\n            sender: \"ai\",\n            text: data.aiText,\n            avatar: `/avatars/${characterId}.jpg`\n          }]);\n        }\n        if (data.liked) {\n          setFavor(prev => prev + 1);\n        }\n      } else {\n        console.error(\"Failed to send message:\", data.error);\n      }\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n    } finally {\n      setLoading(false);\n    }\n  }, [input, characterId, messages]);\n  return {\n    messages,\n    input,\n    setInput,\n    sendMessage,\n    setMessages,\n    loading,\n    favor\n  };\n}\n_s(useChat, \"oR8J9H1zY5tG5MXtU5L9LieMQiY=\");","map":{"version":3,"names":["useCallback","useEffect","useState","useChat","characterId","_s","messages","setMessages","input","setInput","loading","setLoading","favor","setFavor","userId","fetch","then","res","json","data","ok","map","msg","sender","text","message","avatar","undefined","sendMessage","trim","prev","userMsg","shouldCheckFavor","length","response","method","headers","body","JSON","stringify","history","slice","concat","aiText","liked","console","error"],"sources":["/Users/seungsoohan/LovleChat/frontend/src/hooks/useChat.ts"],"sourcesContent":["import { useCallback, useEffect, useState } from \"react\";\n\nexport interface Msg {\n  sender: \"user\" | \"ai\";\n  text: string;\n  avatar?: string;\n}\n\nexport function useChat(characterId: string) {\n  const [messages, setMessages] = useState<Msg[]>([]);\n  const [input, setInput] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [favor, setFavor] = useState(0);\n  const userId = \"user_74127\";\n\n  // 메시지 불러오기\n  useEffect(() => {\n    if (!characterId) return;\n    fetch(`/api/chat?userId=${userId}&characterId=${characterId}`)\n      .then(res => res.json())\n      .then(data => {\n        if (data.ok) {\n          setMessages(\n            data.messages.map((msg: any) => ({\n              sender: msg.sender,\n              text: msg.message,\n              avatar: msg.sender === \"ai\" ? `/avatars/${characterId}.jpg` : undefined,\n            }))\n          );\n        }\n      });\n  }, [characterId]);\n\n  const sendMessage = useCallback(async (msg: string) => {\n    if (!msg.trim()) return;\n\n    setLoading(true);\n    // 사용자가 보낸 메시지\n    setMessages((prev) => [...prev, { sender: \"user\", text: msg }]);\n    const userMsg = msg;\n    setInput(\"\");\n\n    try {\n      // 최근 10개 대사 history로 전송, 5턴마다만 체크\n      const shouldCheckFavor = (messages.length + 1) % 5 === 0;\n      const response = await fetch(\"/api/chat\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          userId,\n          characterId,\n          message: userMsg,\n          sender: \"user\",\n          history: shouldCheckFavor ? messages.slice(-9).concat([{ sender: \"user\", text: msg }]) : undefined\n        }),\n      });\n      const data = await response.json();\n      \n      if (data.ok) {\n        // AI 답변이 있으면 메시지에 추가\n        if (data.aiText) {\n          setMessages((prev) => [\n            ...prev,\n            {\n              sender: \"ai\",\n              text: data.aiText,\n              avatar: `/avatars/${characterId}.jpg`,\n            },\n          ]);\n        }\n        if (data.liked) {\n          setFavor((prev) => prev + 1);\n        }\n      } else {\n        console.error(\"Failed to send message:\", data.error);\n      }\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n    } finally {\n      setLoading(false);\n    }\n  }, [input, characterId, messages]);\n\n  return { messages, input, setInput, sendMessage, setMessages, loading, favor };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}